<div class="profile" *ngIf="!isLoading; else loadingTemplate">
  <!-- Profile Header (without navigation) -->
  <div class="profile__header">
    <div class="profile__header-content">
      <h1 class="profile__title">My Profile</h1>
      <p class="profile__subtitle">
        Manage your personal information and bookings
      </p>
    </div>
    <div class="profile__header-pattern"></div>
  </div>

  <!-- Profile Content -->
  <div class="profile__content">
    <!-- User Information Section -->
    <div class="profile__section">
      <div class="profile__section-header">
        <h2 class="profile__section-title">Personal Information</h2>
        <div class="profile__section-line"></div>
      </div>
      <div class="profile__card">
        <div class="profile__card-accent"></div>
        <form [formGroup]="userForm" (ngSubmit)="saveUserInfo()">
          <div class="profile__form-row">
            <div class="profile__form-group">
              <label class="profile__label">First Name</label>
              <input
                type="text"
                formControlName="firstName"
                class="profile__input"
              />
              <div
                *ngIf="
                  userForm.get('firstName')?.invalid &&
                  userForm.get('firstName')?.touched
                "
                class="profile__error"
              >
                First name is required
              </div>
            </div>

            <div class="profile__form-group">
              <label class="profile__label">Last Name</label>
              <input
                type="text"
                formControlName="lastName"
                class="profile__input"
              />
              <div
                *ngIf="
                  userForm.get('lastName')?.invalid &&
                  userForm.get('lastName')?.touched
                "
                class="profile__error"
              >
                Last name is required
              </div>
            </div>
          </div>

          <div class="profile__form-row">
            <div class="profile__form-group">
              <label class="profile__label">Email</label>
              <input
                type="email"
                formControlName="email"
                class="profile__input"
              />
              <div
                *ngIf="
                  userForm.get('email')?.invalid &&
                  userForm.get('email')?.touched
                "
                class="profile__error"
              >
                Please enter a valid email
              </div>
            </div>

            <div class="profile__form-group">
              <label class="profile__label">Phone Number</label>
              <input
                type="tel"
                formControlName="phone"
                class="profile__input"
              />
              <div
                *ngIf="
                  userForm.get('phone')?.invalid &&
                  userForm.get('phone')?.touched
                "
                class="profile__error"
              >
                Please enter a valid phone number
              </div>
            </div>
          </div>

          <div class="profile__form-row">
            <div class="profile__form-group">
              <label class="profile__label">Address</label>
              <input
                type="text"
                formControlName="address"
                class="profile__input"
              />
            </div>

            <div class="profile__form-group">
              <label class="profile__label">City</label>
              <input
                type="text"
                formControlName="city"
                class="profile__input"
              />
            </div>
          </div>

          <div class="profile__form-row">
            <div class="profile__form-group">
              <label class="profile__label">Country</label>
              <select formControlName="country" class="profile__input">
                <option value="">Select a country</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="FR">France</option>
                <option value="DE">Germany</option>
                <option value="IT">Italy</option>
                <option value="ES">Spain</option>
                <option value="JP">Japan</option>
                <option value="CN">China</option>
              </select>
            </div>

            <div class="profile__form-group">
              <label class="profile__label">Postal Code</label>
              <input
                type="text"
                formControlName="postalCode"
                class="profile__input"
              />
            </div>
          </div>

          <div class="profile__actions">
            <button
              type="submit"
              class="profile__button profile__button--primary"
              [disabled]="userForm.invalid || !userForm.dirty"
            >
              Save Changes
            </button>
            <button
              type="button"
              class="profile__button profile__button--secondary"
              (click)="openChangePasswordModal()"
            >
              Change Password
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Hotel Reservations Section -->
    <div class="profile__section">
      <div class="profile__section-header">
        <h2 class="profile__section-title">Hotel Reservations</h2>
        <div class="profile__section-line"></div>
      </div>
      <div class="profile__card">
        <div class="profile__card-accent"></div>
        <div *ngIf="hotelReservations.length > 0; else noHotelReservations">
          <div class="profile__reservations">
            <div
              class="profile__reservation"
              *ngFor="let reservation of hotelReservations"
            >
              <div
                class="profile__reservation-image"
                [style.background-image]="'url(' + reservation.imageUrl + ')'"
              >
                <div
                  class="profile__reservation-status"
                  [ngClass]="
                    'profile__reservation-status--' +
                    reservation.status.toLowerCase()
                  "
                >
                  {{ reservation.status }}
                </div>
                <div class="profile__reservation-overlay"></div>
              </div>

              <div class="profile__reservation-content">
                <h3 class="profile__reservation-title">
                  {{ reservation.hotelName }}
                </h3>

                <div class="profile__reservation-details">
                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Room</span>
                    <span class="profile__reservation-value">{{
                      reservation.roomNumber
                    }}</span>
                  </div>

                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Check-in</span>
                    <span class="profile__reservation-value">{{
                      reservation.checkIn | date : "MMM d, y"
                    }}</span>
                  </div>

                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Check-out</span>
                    <span class="profile__reservation-value">{{
                      reservation.checkOut | date : "MMM d, y"
                    }}</span>
                  </div>

                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Price</span>
                    <span
                      class="profile__reservation-value profile__reservation-value--price"
                      >$ {{ reservation.price }}</span
                    >
                  </div>
                </div>

                <div
                  class="profile__reservation-actions"
                  *ngIf="reservation.status === 'Confirmed'"
                >
                  <button
                    class="profile__reservation-button profile__reservation-button--cancel"
                    (click)="cancelHotelReservation(reservation.id)"
                  >
                    Cancel Reservation
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noHotelReservations>
          <div class="profile__empty-state">
            <div class="profile__empty-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"
                ></path>
              </svg>
            </div>
            <p class="profile__empty-text">No active hotel reservations</p>
            <a href="/hotels" class="profile__empty-link">Browse Hotels</a>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Restaurant Reservations Section -->
    <div class="profile__section">
      <div class="profile__section-header">
        <h2 class="profile__section-title">Restaurant Reservations</h2>
        <div class="profile__section-line"></div>
      </div>
      <div class="profile__card">
        <div class="profile__card-accent"></div>
        <div
          *ngIf="
            restaurantReservations.length > 0;
            else noRestaurantReservations
          "
        >
          <div class="profile__reservations">
            <div
              class="profile__reservation"
              *ngFor="let reservation of restaurantReservations"
            >
              <div
                class="profile__reservation-image"
                [style.background-image]="'url(' + reservation.imageUrl + ')'"
              >
                <div
                  class="profile__reservation-status"
                  [ngClass]="
                    'profile__reservation-status--' +
                    reservation.status.toLowerCase()
                  "
                >
                  {{ reservation.status }}
                </div>
                <div class="profile__reservation-overlay"></div>
              </div>

              <div class="profile__reservation-content">
                <h3 class="profile__reservation-title">
                  {{ reservation.restaurantName }}
                </h3>

                <div class="profile__reservation-details">
                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Table</span>
                    <span class="profile__reservation-value">{{
                      reservation.tableNumber
                    }}</span>
                  </div>

                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Date</span>
                    <span class="profile__reservation-value">{{
                      reservation.date | date : "MMM d, y"
                    }}</span>
                  </div>

                  <div class="profile__reservation-info">
                    <span class="profile__reservation-label">Time</span>
                    <span class="profile__reservation-value">{{
                      reservation.time
                    }}</span>
                  </div>
                </div>

                <div
                  class="profile__reservation-actions"
                  *ngIf="reservation.status === 'Confirmed'"
                >
                  <button
                    class="profile__reservation-button profile__reservation-button--cancel"
                    (click)="cancelRestaurantReservation(reservation.id)"
                  >
                    Cancel Reservation
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noRestaurantReservations>
          <div class="profile__empty-state">
            <div class="profile__empty-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M17 9V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4"
                ></path>
                <polyline points="9 15 12 12 9 9"></polyline>
                <line x1="12" y1="12" x2="3" y2="12"></line>
                <path d="M21 12v4h-4"></path>
                <path d="M17 12v-4h4"></path>
              </svg>
            </div>
            <p class="profile__empty-text">No active restaurant reservations</p>
            <a href="/restaurants" class="profile__empty-link"
              >Browse Restaurants</a
            >
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Loading Template (reverted to simpler version) -->
<ng-template #loadingTemplate>
  <div class="profile__loading">
    <div class="profile__spinner"></div>
    <p class="profile__loading-text">Loading your profile...</p>
  </div>
</ng-template>

<!-- Change Password Modal (with fixed padding) -->
<div class="profile__modal" *ngIf="showPasswordModal">
  <div
    class="profile__modal-backdrop"
    (click)="closeChangePasswordModal()"
  ></div>
  <div class="profile__modal-content">
    <div class="profile__modal-header">
      <h2 class="profile__modal-title">Change Password</h2>
      <button class="profile__modal-close" (click)="closeChangePasswordModal()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="profile__modal-body">
      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
        <div class="profile__form-group">
          <label class="profile__label">Current Password</label>
          <input
            type="password"
            formControlName="currentPassword"
            class="profile__input"
          />
          <div
            *ngIf="
              passwordForm.get('currentPassword')?.invalid &&
              passwordForm.get('currentPassword')?.touched
            "
            class="profile__error"
          >
            Current password is required
          </div>
        </div>

        <div class="profile__form-group">
          <label class="profile__label">New Password</label>
          <input
            type="password"
            formControlName="newPassword"
            class="profile__input"
          />
          <div
            *ngIf="
              passwordForm.get('newPassword')?.invalid &&
              passwordForm.get('newPassword')?.touched
            "
            class="profile__error"
          >
            Password must be at least 8 characters
          </div>
        </div>

        <div class="profile__form-group">
          <label class="profile__label">Confirm New Password</label>
          <input
            type="password"
            formControlName="confirmPassword"
            class="profile__input"
          />
          <div
            *ngIf="
              passwordForm.get('confirmPassword')?.invalid &&
              passwordForm.get('confirmPassword')?.touched
            "
            class="profile__error"
          >
            Passwords do not match
          </div>
        </div>

        <div class="profile__modal-actions">
          <button
            type="button"
            class="profile__button profile__button--secondary"
            (click)="closeChangePasswordModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="profile__button profile__button--primary"
            [disabled]="passwordForm.invalid"
          >
            Change Password
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
